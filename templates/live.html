{% extends "layout.html" %}
{% block content %}

{% if total is defined and elapsed is defined %}
<div>
    <strong>Total messages:</strong> {{ total }} |
    <strong>Render time:</strong> {{ "%.2f"|format(elapsed) }} ms
</div>
{% endif %}

<h2>Live Feed (last 25 messages)</h2>
<div id="messages">Loadingâ€¦</div>

<script>
async function loadLatest() {
    const r = await fetch("/api/latest");
    const data = await r.json();

    let html = "";
    data.forEach(m => {
        html += `
        <div class="msg">
            <div class="capcodes">${m.capcodes}</div>
            <div>${m.message}</div>
            <div class="timestamp">${m.timestamp}</div>
        </div>`;
    });

    document.getElementById("messages").innerHTML = html;
}

loadLatest();
setInterval(loadLatest, 1000);
</script>

{% endblock %}
